---
title: "Compare PCSS and RAVs"
author: "Sehyun Oh"
date: "`r Sys.Date()`"
output:
  BiocStyle::html_document:
    toc: true
    toc_float: false
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
## Packages in GitHub
pkgs <- c("GenomicSuperSignature")
new_pkgs <- pkgs[!(pkgs %in% rownames(installed.packages()))]
if(length(new_pkgs) != 0) devtools::install_github(paste0("shbrief/", new_pkgs))

## Load packages
suppressPackageStartupMessages({
  library(GenomicSuperSignature)
})
```

# avgLoading from CRC paper
This is the table of top 4 average loadings (= PCSS, PC Cluster Subtype Scores) 
built in the [CRC paper](https://genomebiology.biomedcentral.com/articles/10.1186/s13059-018-1511-4).

```{r}
avgLoading <- read.table("data/avg_loadings.csv", 
                         header = TRUE, sep = ",")
avgLoading <- tibble::column_to_rownames(avgLoading, var="X")
colnames(avgLoading) <- paste0("PCSS", 1:4)
```

# RAVmodel
```{r message=FALSE, warning=FALSE, echo=FALSE}
## If GenomicSuperSignaturePaper is built locally with RAVmodel in inst/extdata
data.dir <- system.file("extdata", package = "GenomicSuperSignaturePaper")
RAVmodel <- readRDS(file.path(data.dir, "RAVmodel_C2.rds"))
```

```{r eval=FALSE}
RAVmodel <- getModel("C2", load=TRUE)
```

```{r}
RAVmodel

updateNote(RAVmodel)
```

# RAVs most similar to PCSS1/PCSS2
We identified RAV1575 and RAV834 as the most similar RAVs to PCSS1 and PCSS2, 
respectively, based on Pearson correlation coefficient.

```{r}
cg <- intersect(rownames(avgLoading), rownames(RAVmodel))
loading_cor <- abs(stats::cor(avgLoading[cg,], RAVindex(RAVmodel)[cg,], 
                              use="pairwise.complete.obs", method="pearson"))

max1 <- which.max(loading_cor[1,])  # max. correlation with PCSS1
max2 <- which.max(loading_cor[2,])  # max. correlation with PCSS2

loading_cor[1, max1, drop = FALSE]
loading_cor[2, max2, drop = FALSE]
```

Using `annotateRAV` function, we checked the MSigDB C2 genesets that are 
enriched in RAV1575 and RAV834.

```{r collapse=FALSE}
annotateRAV(RAVmodel, 1575)
annotateRAV(RAVmodel, 834)
```

# Session Info

<details>
```{r}
sessionInfo()
```
</details>

